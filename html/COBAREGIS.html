<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Halaman Registrasi</title>
    <link rel="stylesheet" href="../css/styleLogin.css" .css />
    <link href="../bootstrap-5.2.0-dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="../bootstrap-5.2.0-dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    </div>
    <center>
      <img src="../img/mushrooms (1).png" width="8%" />
      <div class="login">
        <h3><b>Register</b></h3>
            <input class="form-control" type="text" placeholder="Nama Lengkap" id="nama"aria-label="Nama Lengkap">
            <input class="form-control" type="text" placeholder="NISN" id="nisn"aria-label="NISN">
            <select class="form-select" id="kelas"aria-label="Kelas">
              <option value="Kosong">Pilih Kelas</option>  
              <option value="X PIS 1">X PIS 1</option>
              <option value="X PIS 2">X PIS 2</option>
              <option value="X PIS 3">X PIS 3</option>
          </select>
          <select class="form-select" style="margin-top:5px" id="sekolah"aria-label="Default select example">
            <option value="Kosong">Pilih Sekolah</option> 
            <option value="SMAN 9 Banjarmasin">SMAN 9 Banjarmasin </option>
          </select>
          <input class="form-control" type="text" placeholder="Password" id="password"aria-label="Password">
      </div>
          <div class="masuk">
            <button type="button" id="submit"class="btn">Daftar</button>
          </div>
    </center>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAVWYeDrtN5WY7cy-mxIglWjAAV5zB9fXY",
        authDomain: "mediajamur-161e3.firebaseapp.com",
        databaseURL: "https://mediajamur-161e3-default-rtdb.firebaseio.com",
        projectId: "mediajamur-161e3",
        storageBucket: "mediajamur-161e3.appspot.com",
        messagingSenderId: "853131171769",
        appId: "1:853131171769:web:3e11269f308565e4450868",
        measurementId: "G-CNY9XMSXWL"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
    

      import { getDatabase, ref, child, set, get} from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js";
      const db = getDatabase();

      //referensi//
      const nama = document.getElementById('nama');
      const nisn = document.getElementById('nisn');
      const kelas = document.getElementById('kelas');
      const sekolah = document.getElementById('sekolah');
      const password = document.getElementById('password');
      const submit = document.getElementById('submit');

//Validation//

function isEmptyOrSpaces(str){
            return str === null || str.match(/^ *$/) !== null;
        }

function Validation(){
  let nameregex = /^[a-zA-Z\s]+$/;
  let nisnregex = /^[0-9\s]+$/;

  if(!nameregex.test(nama.value)){
    alert("Nama gunakan Alfabet");
    return false;
  }
  if(!nisnregex.test(nisn.value)){
    alert("NISN gunakan Angka");
    return false;
  }
  return true;
}
      //Register-database//
      function RegisterUser(){
            if (!Validation()){
                return;
            };
            const dbRef = ref(db);

            get(child(dbRef, "DataSiswa"+ nisn.value)).then((snapshot)=>{
                if(snapshot.exists()){
                    alert("Data sudah terdaftar!");
                }
                else{
                    set(ref(db, "DataSiswa/"+ nisn.value),
                    {
                        nama: nama.value,
                        nisn: nisn.value,
                        password : password.value,
                        kelas: kelas.value,
                        sekolah: sekolah.value,
  
                        
                    })
                    .then(()=>{
                        alert("registrasi berhasil");
                        window.location = "register.html";
                    })
                    .catch((error)=>{
                        alert("Register Gagal");
                    })
                }
            });
        }

        
        //Assign the events
        submit.addEventListener('click', RegisterUser);

      
    </script>
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Halaman Registrasi</title>
    <link rel="stylesheet" href="../css/styleLogin.css" .css />
    <link href="../bootstrap-5.2.0-dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="../bootstrap-5.2.0-dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    </div>
    <center>
      <img src="../img/mushrooms (1).png" width="8%" />
      <div class="login">
        <h3><b>Register</b></h3>
            <input class="form-control" type="text" placeholder="Nama Lengkap" id="nama"aria-label="Nama Lengkap">
            <input class="form-control" type="text" placeholder="NISN" id="nisn"aria-label="NISN">
            <select class="form-select" id="kelas"aria-label="Kelas">
              <option value="Kosong">Pilih Kelas</option>  
              <option value="X PIS 1">X PIS 1</option>
              <option value="X PIS 2">X PIS 2</option>
              <option value="X PIS 3">X PIS 3</option>
          </select>
          <select class="form-select" style="margin-top:5px" id="sekolah"aria-label="Default select example">
            <option value="Kosong">Pilih Sekolah</option> 
            <option value="SMAN 9 Banjarmasin">SMAN 9 Banjarmasin </option>
          </select>
          <input class="form-control" type="text" placeholder="Password" id="password"aria-label="Password">
      </div>
          <div class="masuk">
            <button type="button" id="submit"class="btn">Daftar</button>
          </div>
    </center>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAVWYeDrtN5WY7cy-mxIglWjAAV5zB9fXY",
        authDomain: "mediajamur-161e3.firebaseapp.com",
        databaseURL: "https://mediajamur-161e3-default-rtdb.firebaseio.com",
        projectId: "mediajamur-161e3",
        storageBucket: "mediajamur-161e3.appspot.com",
        messagingSenderId: "853131171769",
        appId: "1:853131171769:web:3e11269f308565e4450868",
        measurementId: "G-CNY9XMSXWL"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
    

      import { getDatabase, ref, child, set, get} from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js";
      const db = getDatabase();

      //referensi//
      const nama = document.getElementById('nama');
      const nisn = document.getElementById('nisn');
      const kelas = document.getElementById('kelas');
      const sekolah = document.getElementById('sekolah');
      const password = document.getElementById('password');
      const submit = document.getElementById('submit');

//Validation//

function isEmptyOrSpaces(str){
            return str === null || str.match(/^ *$/) !== null;
        }

function Validation(){
  let nameregex = /^[a-zA-Z\s]+$/;
  let nisnregex = /^[0-9\s]+$/;

  if(!nameregex.test(nama.value)){
    alert("Nama gunakan Alfabet");
    return false;
  }
  if(!nisnregex.test(nisn.value)){
    alert("NISN gunakan Angka");
    return false;
  }
  return true;
}
      //Register-database//
      function RegisterUser(){
            if (!Validation()){
                return;
            };
            const dbRef = ref(db);

            get(child(dbRef, "DataSiswa"+ nisn.value)).then((snapshot)=>{
                if(snapshot.exists()){
                    alert("Data sudah terdaftar!");
                }
                else{
                    set(ref(db, "DataSiswa/"+ nisn.value),
                    {
                        nama: nama.value,
                        nisn: nisn.value,
                        password : password.value,
                        kelas: kelas.value,
                        sekolah: sekolah.value,
  
                        
                    })
                    .then(()=>{
                        alert("registrasi berhasil");
                        window.location = "register.html";
                    })
                    .catch((error)=>{
                        alert("Register Gagal");
                    })
                }
            });
        }

        
        //Assign the events
        submit.addEventListener('click', RegisterUser);

      
    </script>
  </body>
</html>
