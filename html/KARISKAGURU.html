
<!DOCTYPE html>
<html>
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Siswa || Halaman Guru</title>
    <link href="IMG/favicon.png" rel="icon" />

    <!-- Custom fonts for this template-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
      integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" />

    <!-- Custom styles for this template-->
    <link href="CSS/sb-admin.css" rel="stylesheet" />
    <link href="../css/cssstyle.css" rel="stylesheet" />
    <link href="../css/style siswa.css" rel="stylesheet" />
  </head>
  <body id="page-top">
    <!-- Page Wrapper
    <div id="wrapper">
      <!-- Sidebar Menu -->
      <ul class="navbar-nav sidebar sidebar-dark accordion" style="background-color: #1a2c42" id="accordionSidebar">
        <!-- Sidebar Toggler (Sidebar Menu Kecil) -->
        <div class="mt-3 text-center d-none d-md-inline">
          <div class="text-center d-none d-md-inline">
            <button class="fas fa-list-ul border-0 float-left" style="background-color: #d48166" id="sidebarToggle"></button>
          </div>
        </div>
        <center>
          
          <img src="img/profil.png" class="img-fluid" alt="..." style="width: 85px" />

          <h1 style="font-family: 'Lucida Sans'; font-size: 30px; color: #fff" data-aos="fade-up"><span id="userlink"></span></h1>

          <button class="bi bi-box-arrow-right btn" style="background-color: #d48166; color: #000; border: 3px solid #ffdead; font-size: 16px" type="submit" id="logout">Log Out</button><br /><br /><br />
        </center>

        <hr class="sidebar-divider my-0" />
     
        <li class="nav-item">
          <a class="nav-link active" style="background-color: #d48166; border: dashed #ffdead; border-radius: 20px" href="Siswa.html">
            <i class="bi bi-person-circle" style="color: white; font-size: 20px"></i>
            <span style="color: white; font-size: 16px">Data Siswa</span></a
          >
        </li>
        <hr class="sidebar-divider my-0" />

        <li class="nav-item">
          <a class="nav-link" href="HasilPenyajian.html">
            <i class="bi bi-clipboard2-check-fill" style="color: white; font-size: 20px"></i>
            <span style="color: white; font-size: 16px">Hasil Lembar Kerja</span></a
          >
        </li>
        <hr class="sidebar-divider my-0" />

        <li class="nav-item">
          <a class="nav-link" href="datatable.html">
            <i class="bi bi-ui-checks" style="color: white; font-size: 20px"></i>
            <span style="color: white; font-size: 16px">Hasil Belajar</span></a
          >
        </li>
        <hr class="sidebar-divider my-0" />
        <li class="nav-item">
          <a class="nav-link active" href="aturKKM.html">
            <i class="bi bi-pencil-square" style="color: white; font-size: 20px"></i>
            <span style="color: white; font-size: 16px">Pengaturan <br>Kuis/Evaluasi dan KKM</span></a
          >
        </li>
      </ul>

      <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
          <!-- Topbar -->
          <nav class="navbar navbar-expand" style="background-color: #d48166">
            <!-- Sidebar Toggle (Topbar) -->
            <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
              <i class="fa fa-magnet"></i>
            </button>

            <!-- Page Heading -->
            
            <div class="d-sm-flex align-items-center justify-content-between" style="color:#000; font-size:50px; font-family: lucida sans;"> Data Siswa
             
           
    
              </div>
            
           
          </nav>
        <!--Akhir Navbar-->
        <div class="" style="background-color: #fdefeb"> -->
            <!-- Content Row -->
            <div class="container">
              <div class="row" style="height: 20%; width: 100%"></div>
                    
        <!--isi-->
        <!-- <div class="card-body"> -->
            <div class="main"><br> 
                <div class="wrapper">
                  <button class="tmb-siswa m-2 text-white" style="background-color:#1a2c42; border-radius: 10px; border:solid; border-color: #d48166;">Tambah Data</button>
                  <br>
                  <br>
                  <br>
                  
                  <table id="ex-table" class=" table table table-striped table-light table-hover table-bordered table-condensed"></table>
                  
                  </div>
                  <div class="popup add">
                    <form action="">
                      <input type="text" placeholder="Nama" name="nama">
                      <input type="number" placeholder="NISN" name="nis">
                      <input type="text" placeholder="kelas" name="kelas">
                      <input type="text" placeholder="sekolah" name="sekolah">
                      <!-- <input type="number" placeholder="Nomor HP" name="telepon"> -->
                      <input type="password" placeholder="Password" name="password">
        
                      <button type="submit" class="btn" style="background-color:#1a2c42; color:white;">Tambah Data</button>
                    </form>
                  </div>
                  <div class="popup update">
                    <form action="">
                      <input type="text" placeholder="Nama" name="nama">
                      <input type="number" placeholder="NISN" name="nis">
                      <input type="text" placeholder="kelas" name="kelas">
                      <input type="text" placeholder="sekolah" name="sekolah">
                      <!-- <input type="number" placeholder="Nomor Hp" name="telepon"> -->
                      <input type="password" placeholder="Password" name="password">
                    
                      <button type="submit" class="btn btn-success">Ubah Data</button>
                    </form>
             
            </div>
          </div>
        <!--akhir main-->
      </div>
    </div>
    <br />
    <nav aria-label="...">
      <ul class="pagination" >
        <li class="page-item disabled" id="btnprev">
        </li>
        
        <a class="btn text-white " style="background-color:#1a2c42; border-radius:10px; font-family: lucida sans; font-size:20px;" id="mnext" href="HasilPenyajian.html">Halaman Selanjutnya</a>
  
     </ul>
    </nav>
  </div>

            </div>
            <a class="scroll-to-top rounded" href="#page-top">
                <i class="fas fa-angle-up"></i>
              </a>
              <script src="JS/jquery.min.js"></script>
              <script src="JS/bootstrap.bundle.min.js"></script>
              <script src="JS/sbadmin2.js"></script>
             
         

    <!-- akhir content-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>


    <script type="module"> 
 $(".sidebar ul li").on('click' , function(){
    $(".sidebar ul li.aktief").removeClass('active');
    $(this).addClass('active');
  }); 

  $('.open-btn').on('click', function(){
    $('.sidebar').addClass('active');
  });

  $('.close-btn').on('click', function(){
    $('.sidebar').removeClass('active');
  })
    var dropdown = document.getElementsByClassName("dropdown-btn");
var i;
    var dropdown = document.getElementsByClassName("dropdown-btn");
var i;

for (i = 0; i < dropdown.length; i++) {
  dropdown[i].addEventListener("click", function() {
    this.classList.toggle("aktif");
    var dropdownContent = this.nextElementSibling;
    if (dropdownContent.style.display === "block") {
      dropdownContent.style.display = "none";
    } else {
      dropdownContent.style.display = "block";
    }
  });
}

      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-app.js";
      import { getDatabase, update, remove, ref, get, set, child, onValue, onChildAdded } from "https://www.gstatic.com/firebasejs/9.11.0/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBao_sbYCHawUpfWf1w7kpeCd-p658afBY",
        authDomain: "medanmagnetik-a9cd4.firebaseapp.com",
        databaseURL: "https://medanmagnetik-a9cd4-default-rtdb.firebaseio.com",
        projectId: "medanmagnetik-a9cd4",
        storageBucket: "medanmagnetik-a9cd4.appspot.com",
        messagingSenderId: "285660468832",
        appId: "1:285660468832:web:579d68ef9d6d73ab229505",
      };
      const app = initializeApp(firebaseConfig);
      var dataSrc = [];
      var count = 1;
      //create firebase database reference
      // function loadData(callback) {
      var db = getDatabase();
      const siswaRef = ref(db, "Data-Siswa/");
      //--------------MENDAPATKAN NAMA USER--------------
      let userlink = document.getElementById("userlink");
      let namaUser = sessionStorage.getItem("nama");
      let nisUser = sessionStorage.getItem("nis");
      let kelasUser = sessionStorage.getItem("kelas");
      let sekolahUser = sessionStorage.getItem("sekolah");
      // let teleponUser = sessionStorage.getItem("telepon");
      let passwordUser = sessionStorage.getItem("password");

      function getNama(){ 
          if(namaUser == null){ 
            alert("Maaf, kamu harus login lebih dulu");
            window.location = "loginguru.html";
          }else{ 
            userlink.innerText = namaUser; 
          }
        }
        getNama(); 

        let tableBody = document.querySelector("tbody");
        let tmbSiswa = document.querySelector(".tmb-siswa");
        let popup = document.querySelector(".popup");
        let addForm = document.querySelector(".add form");
        let updateForm = document.querySelector(".update form");

      onChildAdded(siswaRef, (snapshot) => {
          var storageObj = snapshot.val();
          function edit() {
            console.log("edit");
          }
          var dataSet = [
            storageObj.nis,
            storageObj.fullname,
            storageObj.kelas,
            storageObj.sekolah,
            // storageObj.telepon,
            storageObj.password,
            `<button class="edit btn-success btn text-white" data-id="${storageObj.nis}">Ubah</button> 
            <button class="delete btn-danger btn text-white" data-id="${storageObj.nis}">Hapus</button>`,
          ];
          // console.log(dataSet);
          dataSrc.push(dataSet);
          count++;

          var dTable = $("#ex-table").DataTable({
            bDestroy: true,
            data: dataSrc,
            columns: [{ title: "NISN" }, { title: "Nama" }, { title: "Kelas" }, { title: "Sekolah" }, { title: "Password" }, { title: "Aksi" }],
            lengthMenu: [
              [5, 10, -1],
              [5, 10, "all"]],
            
          });
      //menambah data
      function writeUserData(nis, nama, kelas, sekolah, telepon, password) {
        const db = getDatabase();
        if (nis != "" && nama != "" && kelas != "" && sekolah != "" && password != "") {
          set(ref(db, "Data-Siswa/" + nis), {
            nis: nis,
            fullname: nama,
            kelas: kelas,
            // telepon: telepon,
            sekolah: sekolah,
            password: password,
          }).then(() => {
            // Data saved successfully!
            alert("Data berhasil ditambahkan!");
            document.querySelector(".add").classList.remove("active");
            addForm.reset();
          });
        } else {
          alert("Lengkapi data terlebih dahulu!");
        }
      }
        
          let editSiswa = document.querySelectorAll(".edit");
          editSiswa.forEach((edit) => {
            edit.addEventListener("click", () => {
              document.querySelector(".update").classList.add("active");
              let userId = edit.dataset.id;
              console.log(userId);
              //console.log(edit.parentElement.parentElement.dataset.id);
              const dbRef = ref(getDatabase());
              get(child(dbRef, `Data-Siswa/${userId}`)).then((snapshot) => {
                if (snapshot.exists()) {
                  updateForm.nama.value = snapshot.val().fullname;
                  updateForm.nis.value = snapshot.val().nis;
                  updateForm.kelas.value = snapshot.val().kelas;
                  updateForm.sekolah.value = snapshot.val().sekolah;
                  // updateForm.telepon.value = snapshot.val().telepon;
                  updateForm.password.value = snapshot.val().password;
                } else {
                  console.log("Data tidak ada");
                }
                //document.querySelector('.update').classList.remove("active");
              });

              updateForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const db = getDatabase();
                update(ref(db, "Data-Siswa/" + userId), {
                  nis: updateForm.nis.value,
                  fullname: updateForm.nama.value,
                  kelas: updateForm.kelas.value,
                  sekolah: updateForm.sekolah.value,
                  // telepon: updateForm.telepon.value,
                  password: updateForm.password.value,
                }).then(() => {
                  // Data saved successfully!
                  alert("Data berhasil diubah!");
                  document.querySelector('.update').classList.remove("active");
                  updateForm.reset();
                });
              });
            });
          });
          //hapus data
          let hapusSiswa = document.querySelectorAll(".delete");
          hapusSiswa.forEach((hapus) => {
            hapus.addEventListener("click", () => {
              // console.log("123");
              let userId = hapus.dataset.id;
              const db = getDatabase();
              remove(ref(db, "Data-Siswa/" + userId));
            });
          });
        
      //tambah data
      tmbSiswa.addEventListener("click", () => {
        document.querySelector(".add").classList.add("active");
        addForm.addEventListener("submit", (e) => {
          e.preventDefault();
          //console.log(form.nama.value);
          writeUserData(addForm.nis.value, addForm.nama.value, addForm.kelas.value, addForm.sekolah.value, addForm.password.value);
        });
      });

      //tutup modal
      window.addEventListener("click", (e) => {
        if (e.target == popup) {
          popup.classList.remove("active");
          addForm.reset();
          updateForm.reset();
        }
      });
    });

      // if (callback) {
      //     callback();
      //   }
      // }//akhir function

      // function downloadObjectAsJson(exportObj, exportName) {
      //   var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportObj));
      //   var downloadAnchorNode = document.createElement("a");
      //   downloadAnchorNode.setAttribute("href", dataStr);
      //   downloadAnchorNode.setAttribute("download", exportName + ".json");
      //   var container = document.getElementById("container");
      //   container.appendChild(downloadAnchorNode);
      // }

      // document.addEventListener("DOMContentLoaded", function (event) {
      //   var NewFile = "records";
      //   loadData(downloadObjectAsJson(dataSrc, NewFile));
      // });

      logout.addEventListener("click", (e) => {
        sessionStorage.removeItem("pass");
        sessionStorage.removeItem("nama");
        window.location = "loginguru.html";
      });
    </script>
  </body>
</html>
